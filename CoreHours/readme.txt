readme document for generating .pdf usage reports
Jeremy Clay
12-15-2016


NECESSARY FILES

CoreHoursByMonthReport.py
GenAllOutputFiles.py
GenAllReports.py
ipaShowTools.py
ldapShowTools.py
matplotlibToReportlab.py
mysqlTools.py
UsageReportTools.py
sacctOutputFiles (directory which contains output files generated by sacct)
  *these files are generated on MtMoran. see GENERATING SACCT OUTPUT FILES


DEPENDANCIES

reportlab
numpy
matplotlib
pdfrw
mysql-connector-python

The main python script, GenAllReports.py, can be run using either python 2 or 3 with the previously listed package dependancies installed.


SETTING UP THE VIRTUAL ENVIRONMENT USING ANACONDA PACKAGE MANAGER

By using the Anaconda package manager, a virtual environment can be easily created to run the GenAllReports.py script.  Assuming that Anaconda is already installed, the following lines of code should be input into a terminal command prompt to create the virtual environment and install the necessary packages:

conda create --name [environment name] python=3

source activate [environment name]

conda install -y reportlab

conda install -y numpy

conda install -y matplotlib

conda install -y mysql-connector-python

pip install pdfrw

Once this virtual environment has been created it can be activated and deactivated using the following commands:

source activate [environment name]

source deactivate

Before attempting to run the GenAllReports.py script the virtual environment should be activated.  The Anaconda package manager displays the current environment in (parentheses) or [brackets] in front of your command prompt.  A list of available environments is displayed using the following command:

conda info --envs
 

EXECUTING THE CODE

The main script, GenAllReports.py, can be executed with the following command:

python GenAllReports.py

additional information can be found using the command:

python GenAllReports.py --help


GENERATING SACCT OUTPUT FILES

The files that are in the sacctOutputFiles are generated over on MtMoran using the sacct command.  After these files are generated, they need to be copied over to the sacctOutputFiles directory which is located in the same directory as the GenAllReports.py script.  The sacct command needs to be executed precisely as follows:

sacct -LanPT -o Cluster,Account,Group,CPUTimeRaw --starttime=110116-00:00:00 --endtime=120116-00:00:00 > all_Nov_T.out

the --starttime, --endtime, and output filename should be edited according to the month in question.  For example if collecting statistics for the month of December, 2016 the sacct command would be as follows:

sacct -LanPT -o Cluster,Account,Group,CPUTimeRaw --starttime=120116-00:00:00 --endtime=010117-00:00:00 > all_Dec_T.out

starttime and endtime fields:  --starttime=MMDDYY-HH:MM:SS

output files must be named using the following syntax: all_[month]_T.out

month names should be input using the following abbreviations:

Jan
Feb
Mar
April
May
June
July
Aug
Sept
Oct
Nov
Dec

any deviation from this will result in undesired behavior or code failure.


ADDITIONAL NOTES

GenAllReports.py
Near the end of this script there are two sections enclosed by lines of octothorpes (######################).  The first section is a debugging section that will send the final emails to the email address defined by the variable 'MyEmail'.  The second section (denoted with a warning message at the beginning) will send the composed emails out to all of the PIs.  These sections can be easily commented out to produce the desired result.

mysqlTools.py
lines 25 through 31  establish login information by means of a dictionary named 'config'.  The 'user' and 'password' fields should be editted with the appropriate information. (see Jeff R. Lang)
